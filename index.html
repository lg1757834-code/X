<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Juego de Im√°genes y Palabras en Japon√©s</title>
  <style>
    body {
      background: #000;
      color: #fff;
      text-align: center;
      font-family: Arial, sans-serif;
      margin: 20px;
    }

    #contador {
      margin: 10px 0;
      font-size: 18px;
      font-weight: bold;
    }

    input {
      background: #111;
      color: #fff;
      border: 1px solid #444;
      border-radius: 6px;
      padding: 8px;
      font-size: 16px;
    }

    input::placeholder {
      color: #bbb;
    }

    #visor {
      position: relative;
      display: inline-block;
      max-width: 100%;
    }

    #imagenActual {
      width: 100%;
      border-radius: 8px;
      display: block;
    }

    .mosaico {
      position: absolute;
      background: black;
      opacity: 0.95;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    button {
      margin: 5px;
      padding: 8px 15px;
      border: none;
      border-radius: 6px;
      background: #444;
      color: white;
      cursor: pointer;
      font-size: 16px;
    }

    button:hover {
      background: #666;
    }

    #glosario, #glosarioImagenes {
      margin-top: 30px;
      text-align: left;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }

    #glosario h2, #glosarioImagenes h2 {
      text-align: center;
    }

    #listaGlosario, #listaImagenes {
      list-style: none;
      padding: 0;
    }

    #listaGlosario li, #listaImagenes li {
      background: #111;
      margin: 5px 0;
      padding: 8px;
      border-radius: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .acciones-glosario button {
      margin-left: 5px;
    }
  </style>
</head>
<body>

  <h1>Juego de Im√°genes y Palabras en Japon√©s</h1>

  <div id="contador">Im√°genes: 0 | Palabras: 0</div>

  <h2>Agregar imagen</h2>
  <input type="text" id="urlImagen" placeholder="Pega la URL de la imagen">
  <button onclick="agregarImagen()">Agregar Imagen</button>

  <h2>Agregar palabra</h2>
  <input type="text" id="textoJapones" placeholder="Palabra en japon√©s (ej: Ë∂≥)">
  <input type="text" id="romajiCorrecto" placeholder="Romaji (ej: ashi)">
  <input type="text" id="traduccion" placeholder="Traducci√≥n (ej: pie, pierna)">
  <button onclick="agregarPregunta()">Agregar Palabra</button>

  <h2>Juego</h2>
  <div id="visor">
    <img id="imagenActual" src="" alt="Aqu√≠ aparecer√°n tus im√°genes">
  </div>

  <div id="juego">
    <div id="pregunta" style="margin-top:15px;"></div>
    <div id="opciones" style="margin-top:10px;"></div>
    <div id="resultado" style="margin-top:10px; font-weight:bold;"></div>
    <div id="siguiente" style="margin-top:10px;"></div>
  </div>

  <div id="glosarioImagenes">
    <h2>üì∑ Glosario de Im√°genes</h2>
    <ul id="listaImagenes"></ul>
  </div>

  <div id="glosario">
    <h2>üìñ Glosario de Palabras</h2>
    <ul id="listaGlosario"></ul>
  </div>

  <script>
    let imagenes = JSON.parse(localStorage.getItem("imagenes")) || [];
    let preguntas = JSON.parse(localStorage.getItem("preguntas")) || [];
    let preguntasUsadas = [];
    let indiceImagen = 0;
    let imagenesUsadas = [];
    let mosaico = null;

    actualizarContador();
    renderizarGlosario();
    renderizarGlosarioImagenes();
    nuevaImagen();

    function crearMosaico() {
      const visor = document.getElementById("visor");
      document.querySelectorAll(".mosaico").forEach(m => m.remove());
      mosaico = null;

      const div = document.createElement("div");
      div.classList.add("mosaico");
      visor.appendChild(div);
      mosaico = div;
    }

    function actualizarContador() {
      document.getElementById("contador").textContent =
        `Im√°genes: ${imagenes.length} | Palabras: ${preguntas.length}`;
    }

    function agregarImagen() {
      const url = document.getElementById("urlImagen").value.trim();
      if (!url) return alert("‚ö†Ô∏è Escribe una URL.");
      if (imagenes.includes(url)) return alert("‚ö†Ô∏è Esa URL ya fue agregada.");

      imagenes.push(url);
      localStorage.setItem("imagenes", JSON.stringify(imagenes));
      document.getElementById("urlImagen").value = "";
      actualizarContador();
      renderizarGlosarioImagenes();
      alert("‚úÖ Imagen agregada!");
    }

    function eliminarImagen(idx) {
      if (confirm("¬øSeguro que deseas eliminar esta imagen?")) {
        imagenes.splice(idx, 1);
        localStorage.setItem("imagenes", JSON.stringify(imagenes));
        actualizarContador();
        renderizarGlosarioImagenes();
        if (indiceImagen >= imagenes.length) {
          nuevaImagen();
        }
      }
    }

    function renderizarGlosarioImagenes() {
      const lista = document.getElementById("listaImagenes");
      lista.innerHTML = imagenes.map((url, idx) => `
        <li>
          ${url}
          <span class="acciones-glosario">
            <button onclick="eliminarImagen(${idx})">üóëÔ∏è Borrar</button>
          </span>
        </li>
      `).join("");
    }

    function agregarPregunta() {
      const japones = document.getElementById("textoJapones").value.trim();
      const romaji = document.getElementById("romajiCorrecto").value.trim();
      const traduccion = document.getElementById("traduccion").value.trim();

      if (!japones || !romaji || !traduccion) {
        return alert("‚ö†Ô∏è Llena todos los campos.");
      }

      if (preguntas.some(p => p.japones === japones)) {
        return alert("‚ö†Ô∏è Esa palabra en japon√©s ya fue agregada.");
      }

      preguntas.push({ japones, romaji, traduccion });
      localStorage.setItem("preguntas", JSON.stringify(preguntas));

      document.getElementById("textoJapones").value = "";
      document.getElementById("romajiCorrecto").value = "";
      document.getElementById("traduccion").value = "";

      actualizarContador();
      renderizarGlosario();
      alert("‚úÖ Palabra agregada!");
    }

    function nuevaImagen() {
      if (imagenes.length === 0) {
        document.getElementById("imagenActual").src = "";
        document.getElementById("pregunta").textContent = "‚ö†Ô∏è Agrega im√°genes para jugar.";
        document.getElementById("opciones").innerHTML = "";
        document.getElementById("siguiente").innerHTML = "";
        return;
      }

      if (imagenesUsadas.length === imagenes.length) {
        imagenesUsadas = [];
      }

      let disponibles = imagenes.filter((_, idx) => !imagenesUsadas.includes(idx));
      const idx = Math.floor(Math.random() * disponibles.length);
      indiceImagen = imagenes.indexOf(disponibles[idx]);
      imagenesUsadas.push(indiceImagen);

      const img = document.getElementById("imagenActual");
      img.onload = crearMosaico;
      img.src = imagenes[indiceImagen];

      document.getElementById("siguiente").innerHTML = "";
      mostrarPregunta();
    }

    function mostrarPregunta() {
      document.getElementById("resultado").textContent = "";

      if (preguntas.length < 2) {
        document.getElementById("pregunta").textContent = "‚ö†Ô∏è Agrega al menos 2 palabras para jugar.";
        document.getElementById("opciones").innerHTML = "";
        document.getElementById("siguiente").innerHTML = "";
        return;
      }

      let disponibles = preguntas.filter((_, idx) => !preguntasUsadas.includes(idx));
      if (disponibles.length === 0) {
        preguntasUsadas = [];
        disponibles = preguntas;
      }

      const idx = Math.floor(Math.random() * disponibles.length);
      const pregunta = disponibles[idx];
      const preguntaIndex = preguntas.indexOf(pregunta);
      preguntasUsadas.push(preguntaIndex);

      let opciones = [`${pregunta.romaji} (${pregunta.traduccion})`];
      let otras = preguntas.filter(p => p.romaji !== pregunta.romaji);

      while (opciones.length < 4 && otras.length > 0) {
        const randomIndex = Math.floor(Math.random() * otras.length);
        const p = otras[randomIndex];
        opciones.push(`${p.romaji} (${p.traduccion})`);
        otras.splice(randomIndex, 1);
      }

      opciones = opciones.sort(() => Math.random() - 0.5);

      document.getElementById("pregunta").textContent =
        `¬øC√≥mo se lee esta palabra?: „Äå${pregunta.japones}„Äç`;

      document.getElementById("opciones").innerHTML = opciones.map(op =>
        `<button onclick="responder('${op.split(' ')[0]}','${pregunta.romaji}','${pregunta.japones}','${pregunta.traduccion}')">${op}</button>`
      ).join(" ");
    }

    function responder(opcion, correcta, japones, traduccion) {
      if (opcion === correcta) {
        document.getElementById("resultado").textContent =
          `‚úÖ Correcto: „Äå${japones}„Äç ‚Üí ${correcta} (${traduccion})`;
        if (mosaico) {
          mosaico.remove();
          mosaico = null;
          document.getElementById("opciones").innerHTML = "";
          document.getElementById("pregunta").textContent = "";
          document.getElementById("siguiente").innerHTML =
            `<button onclick="nuevaImagen()">Siguiente Imagen</button>`;
        }
      } else {
        document.getElementById("resultado").textContent = "‚ùå Incorrecto, intenta de nuevo.";
        mostrarPregunta();
      }
    }

    function renderizarGlosario() {
      const lista = document.getElementById("listaGlosario");
      lista.innerHTML = preguntas.map((p, idx) => `
        <li>
          „Äå${p.japones}„Äç ‚Üí ${p.romaji} (${p.traduccion})
          <span class="acciones-glosario">
            <button onclick="editarPalabra(${idx})">‚úèÔ∏è Editar</button>
            <button onclick="eliminarPalabra(${idx})">üóëÔ∏è Borrar</button>
          </span>
        </li>
      `).join("");
    }

    function editarPalabra(idx) {
      const nuevaRomaji = prompt("Nuevo romaji:", preguntas[idx].romaji);
      const nuevaTraduccion = prompt("Nueva traducci√≥n:", preguntas[idx].traduccion);
      if (nuevaRomaji && nuevaTraduccion) {
        preguntas[idx].romaji = nuevaRomaji;
        preguntas[idx].traduccion = nuevaTraduccion;
        localStorage.setItem("preguntas", JSON.stringify(preguntas));
        renderizarGlosario();
      }
    }

    function eliminarPalabra(idx) {
      if (confirm("¬øSeguro que deseas eliminar esta palabra?")) {
        preguntas.splice(idx, 1);
        localStorage.setItem("preguntas", JSON.stringify(preguntas));
        actualizarContador();
        renderizarGlosario();
      }
    }
  </script>

</body>
</html>
